---
layout: default
title: Bowling League Manager
---

<h1>Welcome to the Bowling League</h1>

<!-- Latest Week's Top 3 -->
<div class="section">
    <h2>Latest Week - Top 3 Players</h2>

    {% assign latest_week = site.weeks | sort: "date" | reverse | first %}

    {% if latest_week %}
        <h3>{{ latest_week.title }} - {{ latest_week.date | date: "%B %d, %Y" }}</h3>

        {% assign scores_with_totals = "" | split: "" %}
        {% for score in latest_week.scores %}
            {% assign game_total = score.game1 | plus: score.game2 | plus: score.game3 %}
            {% assign score_data = score | merge: hash: "total", game_total %}
            {% assign scores_with_totals = scores_with_totals | push: score_data %}
        {% endfor %}

        {% assign sorted_scores = scores_with_totals | sort: "total" | reverse %}

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Game 1</th>
                        <th>Game 2</th>
                        <th>Game 3</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for score in sorted_scores limit:3 %}
                        {% assign game_total = score.game1 | plus: score.game2 | plus: score.game3 %}
                        <tr>
                            <td class="rank">{{ forloop.index }}</td>
                            <td>
                                {% assign player_slug = score.player | slugify %}
                                <a href="/players/{{ player_slug }}/" class="player-link">{{ score.player }}</a>
                            </td>
                            <td>{{ score.game1 }}</td>
                            <td>{{ score.game2 }}</td>
                            <td>{{ score.game3 }}</td>
                            <td class="score">{{ game_total }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <p><a href="{{ latest_week.url }}" class="player-link">View Full Results â†’</a></p>
    {% else %}
        <p>No weeks have been recorded yet.</p>
    {% endif %}
</div>

<!-- Top 5 Players by Average -->
<div class="section">
    <h2>Top 5 Players by Average</h2>

    {% comment %}
    Calculate averages for all players and create a sortable string format
    Format: "average|player_name|games|total" with leading zeros for proper string sorting
    {% endcomment %}
    {% assign player_stats = "" | split: "" %}

    {% for player in site.players %}
        {% assign player_name = player.name %}
        {% assign total_games = 0 %}
        {% assign total_score = 0 %}

        {% for week in site.weeks %}
            {% for score in week.scores %}
                {% if score.player == player_name %}
                    {% assign total_games = total_games | plus: 3 %}
                    {% assign game_total = score.game1 | plus: score.game2 | plus: score.game3 %}
                    {% assign total_score = total_score | plus: game_total %}
                {% endif %}
            {% endfor %}
        {% endfor %}

        {% if total_games > 0 %}
            {% assign average = total_score | divided_by: total_games %}
            {% comment %}Create sortable string with padded average{% endcomment %}
            {% assign avg_padded = average | plus: 1000 %}
            {% assign stat_string = avg_padded | append: "|" | append: player_name | append: "|" | append: total_games | append: "|" | append: total_score %}
            {% assign player_stats = player_stats | push: stat_string %}
        {% endif %}
    {% endfor %}

    {% assign sorted_stats = player_stats | sort | reverse %}

    {% if sorted_stats.size > 0 %}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Average</th>
                        <th>Games Played</th>
                        <th>Total Pins</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in sorted_stats limit:5 %}
                        {% assign parts = stat | split: "|" %}
                        {% assign padded_avg = parts[0] | plus: 0 %}
                        {% assign average = padded_avg | minus: 1000 %}
                        {% assign player_name = parts[1] %}
                        {% assign total_games = parts[2] %}
                        {% assign total_score = parts[3] %}
                        <tr>
                            <td class="rank">{{ forloop.index }}</td>
                            <td>
                                {% assign player_slug = player_name | slugify %}
                                <a href="/players/{{ player_slug }}/" class="player-link">{{ player_name }}</a>
                            </td>
                            <td class="score">{{ average }}</td>
                            <td>{{ total_games }}</td>
                            <td>{{ total_score }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No player statistics available yet.</p>
    {% endif %}
</div>

<!-- Quick Links -->
<div class="section">
    <h2>Quick Links</h2>

    {% assign weeks_count = site.weeks | size %}
    {% assign players_count = site.players | size %}

    <p>
        <a href="/weeks/" class="player-link" style="font-size: 1.1em;">
            ðŸ“… View All Weeks ({{ weeks_count }}) â†’
        </a>
    </p>
    <p>
        <a href="/players/" class="player-link" style="font-size: 1.1em;">
            ðŸ‘¥ View All Players ({{ players_count }}) â†’
        </a>
    </p>
</div>
